// Generated by CoffeeScript 1.10.0
(function() {
  var bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.Hub = (function() {
    Hub.prototype.dialogs = {};

    Hub.prototype.currentAppName = 'none';

    function Hub($screens, $desk) {
      var $dialog, deskImage, dialogAppName, dialogFx, dlgtrigger, element, i, j, len, ref, screensImage, self;
      this.$screens = $screens;
      this.$desk = $desk;
      this._onClose = bind(this._onClose, this);
      this._onOpen = bind(this._onOpen, this);
      self = this;
      screensImage = new Image;
      screensImage.src = game.imagePath + 'hub/screens.png';
      this.$screens.prepend(screensImage);
      deskImage = new Image;
      deskImage.src = game.imagePath + 'hub/desk.png';
      this.$desk.prepend(deskImage);
      dlgtrigger = $('[data-dialog]');
      ref = dlgtrigger.toArray();
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        element = ref[i];
        dialogAppName = element.getAttribute('data-dialog');
        $dialog = $('#' + dialogAppName + 'Dialog')[0];
        dialogFx = self.dialogs[dialogAppName] = new DialogFx($dialog, {
          onOpenDialog: (function(dialogAppName) {
            return function(dialog) {
              return self._onOpen(dialogAppName);
            };
          })(dialogAppName),
          onCloseDialog: function(dialog) {
            return self._onClose();
          }
        });
        $(element).click((function(dialogFx) {
          return function() {
            return dialogFx.open();
          };
        })(dialogFx));
      }
      $('#parallax .parallax-layer').parallax({
        mouseport: $('#parallax')
      });
    }

    Hub.prototype._onOpen = function(appName) {
      var app;
      if (this.currentAppName !== 'none') {
        console.warn("[WARNING] Trying to open app " + appName + " but app " + this.currentAppName + " is already open");
        return false;
      }
      app = game.apps[appName];
      if (app.checkCanOpen()) {
        this.currentAppName = appName;
        app.onOpen();
        return true;
      }
      return false;
    };

    Hub.prototype._onClose = function() {
      var app;
      if (this.currentAppName === 'none') {
        console.warn("[WARNING] Trying to close current app but no app is currently open");
        return false;
      }
      app = game.apps[this.currentAppName];
      if (app.checkCanClose()) {
        app.onClose();
        this.currentAppName = 'none';
        return true;
      }
      return false;
    };

    return Hub;

  })();

}).call(this);

//# sourceMappingURL=hub.js.map
